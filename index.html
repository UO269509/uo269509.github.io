<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruleta Europea con Predicción</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #222;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}

h1 {
    margin-bottom: 10px;
}

#input-section {
    margin-bottom: 20px;
}

#history-input {
    width: 250px;
    padding: 5px;
    font-size: 16px;
}

#add-number {
    padding: 5px 10px;
    font-size: 16px;
    margin-left: 5px;
}

#roulette {
    display: grid;
    grid-template-columns: repeat(6, 50px);
    grid-gap: 5px;
    margin-bottom: 20px;
}

.number-cell {
    width: 50px;
    height: 50px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    font-weight: bold;
    cursor: default;
    transition: transform 0.2s;
}

.number-cell:hover {
    transform: scale(1.1);
}

.red {
    background-color: #e74c3c;
}

.black {
    background-color: #34495e;
}

.green {
    background-color: #27ae60;
}

#prediction {
    margin-top: 20px;
    font-size: 18px;
}

#prediction span {
    font-weight: bold;
}
</style>
</head>
<body>

<h1>Ruleta Europea con Predicción</h1>

<div id="input-section">
    <input type="number" id="history-input" min="0" max="36" placeholder="Número salido">
    <button id="add-number">Añadir</button>
</div>

<div id="roulette"></div>

<div id="prediction">
    <p>Los 5 números más probables: <span id="top5">-</span></p>
</div>

<script>
const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
const blackNumbers = [2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35];
let history = [];

// Crea las celdas de la ruleta
function createRoulette() {
    const roulette = document.getElementById('roulette');
    roulette.innerHTML = '';
    for(let i=0; i<=36; i++){
        const cell = document.createElement('div');
        cell.classList.add('number-cell');
        if(i === 0) cell.classList.add('green');
        else if(redNumbers.includes(i)) cell.classList.add('red');
        else cell.classList.add('black');
        cell.id = 'cell-' + i;
        cell.innerHTML = `${i}<br><small>0%</small>`;
        roulette.appendChild(cell);
    }
}

// Actualiza los porcentajes y predicción
function updateRoulette() {
    const counts = Array(37).fill(0);
    for(let n of history) counts[n]++;
    const N = history.length;

    // Actualiza visual de cada celda
    for(let i=0; i<=36; i++){
        const percent = N>0 ? ((counts[i]/N)*100).toFixed(1) : 0;
        const cell = document.getElementById('cell-' + i);
        cell.innerHTML = `${i}<br><small>${percent}%</small>`;
    }

    // Calcula predicción
    const bayesProbs = computeBayes(counts, 1);
    const markovProbs = computeMarkov();
    const ensemble = bayesProbs.map((b,i) => 0.8*b + 0.2*markovProbs[i]);
    const top5Indices = ensemble
        .map((p,i) => ({p,i}))
        .sort((a,b) => b.p - a.p)
        .slice(0,5)
        .map(x => x.i);
    document.getElementById('top5').textContent = top5Indices.join(', ');
}

// Dirichlet posterior (Bayes)
function computeBayes(counts, alpha0=1){
    const K = counts.length;
    const N = counts.reduce((a,b)=>a+b,0);
    return counts.map(c => (c + alpha0) / (N + K*alpha0));
}

// Matriz de transición simple (Markov orden 1)
function computeMarkov(){
    const probs = Array(37).fill(0);
    if(history.length < 2) return probs;
    const transitionCounts = Array.from({length:37},()=>Array(37).fill(0));
    for(let i=1;i<history.length;i++){
        const prev = history[i-1];
        const curr = history[i];
        transitionCounts[prev][curr]++;
    }
    const last = history[history.length-1];
    const total = transitionCounts[last].reduce((a,b)=>a+b,0);
    if(total === 0) return probs;
    for(let i=0;i<37;i++){
        probs[i] = transitionCounts[last][i]/total;
    }
    return probs;
}

// Añade número al historial
document.getElementById('add-number').addEventListener('click',()=>{
    const input = document.getElementById('history-input');
    let n = parseInt(input.value);
    if(!isNaN(n) && n>=0 && n<=36){
        history.push(n);
        input.value = '';
        updateRoulette();
    } else {
        alert('Introduce un número válido entre 0 y 36');
    }
});

// Inicialización
createRoulette();
updateRoulette();
</script>

</body>
</html>
